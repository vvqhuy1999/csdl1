-- 1. tao database

CREATE DATABASE QuanLyDonHang;

USE QuanLyDonHang;

-- 2. create table 

CREATE TABLE KHACHHANG (
    MAKH VARCHAR(5) NOT NULL,
    TENKH VARCHAR(30) NOT NULL,
    DIACHI VARCHAR(100) NULL,
    DTDD VARCHAR(15) NULL,
    CONSTRAINT PK_KHACHHANG PRIMARY KEY (MAKH)
);

CREATE TABLE PHIEUGIAOHANG(
    MAGIAO VARCHAR(4) NOT NULL,
    NGAYGIAO DATE NOT NULL,
    MADAT VARCHAR(4),
    CONSTRAINT PK_PHIEUGIAOHANG PRIMARY KEY (MAGIAO)
);

CREATE TABLE CHITIETGIAOHANG(
    MAGIAO VARCHAR(4) NOT NULL,
    MAHH VARCHAR(2) NOT NULL, 
    SLGIAO INT,
    DONGIAGIAO float,
    CONSTRAINT PK_CHITIETGIAOHANG PRIMARY KEY (MAGIAO, MAHH)
);

CREATE TABLE HANGHOA(
    MAHH VARCHAR(2) NOT NULL, 
    TENHH VARCHAR(50) NOT NULL,
    DVT VARCHAR(5) NULL,
    SLCON INT NULL,
    DONGIAHH float NULL,
    CONSTRAINT CHK_SLCON CHECK (SLCON >= 0),
    CONSTRAINT PK_HANGHOA PRIMARY KEY (MAHH)
);

CREATE TABLE LICHSUGIA(
    MAHH VARCHAR(2) NOT NULL,
    NGAYHL DATE NOT NULL,
    DONGIA float NULL,
    CONSTRAINT PK_LICHSUGIA PRIMARY KEY (MAHH, NGAYHL)
);

CREATE TABLE CHITIETDATHANG(
    MADAT VARCHAR(4) NOT NULL,
    MAHH VARCHAR(2) NOT NULL,
    SLDAT INT NOT NULL,
    CONSTRAINT PK_CHITIETDATHANG PRIMARY KEY (MADAT, MAHH)
);

CREATE TABLE DONDATHANG(
    MADAT VARCHAR(4) NOT NULL,
    NGAYDAT DATE,
    MAKH VARCHAR(5) NOT NULL,
    TINHTRANG BIT NULL,
    CONSTRAINT PK_DONDATHANG PRIMARY KEY (MADAT)
);

-- 3. create foreign key

ALTER TABLE PHIEUGIAOHANG
	ADD CONSTRAINT FK_DONDATHANG_PHIEUGIAOHANG
		FOREIGN KEY (MADAT) REFERENCES DONDATHANG(MADAT);

ALTER TABLE CHITIETGIAOHANG
	ADD CONSTRAINT FK_PHIEUGIAOHANG_CHITIETGIAOHANG
		FOREIGN KEY (MAGIAO) REFERENCES PHIEUGIAOHANG(MAGIAO),
    ADD CONSTRAINT FK_HANGHOA_CHITIETGIAOHANG
		FOREIGN KEY (MAHH) REFERENCES HANGHOA(MAHH);

ALTER TABLE LICHSUGIA
	ADD CONSTRAINT FK_HANGHOA_LICHSUGIA
		FOREIGN KEY (MAHH) REFERENCES HANGHOA(MAHH);

ALTER TABLE CHITIETDATHANG
	ADD CONSTRAINT FK_HANGHOA_CHITIETDATHANG
		FOREIGN KEY (MAHH) REFERENCES HANGHOA(MAHH);

ALTER TABLE DONDATHANG
	ADD CONSTRAINT FK_KHACHHANG_DONDATHANG
		FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH);

ALTER TABLE CHITIETDATHANG
	ADD CONSTRAINT FK_CHITIETDATHANG_DONDH
		FOREIGN KEY (MADAT) REFERENCES DONDATHANG(MADAT);
-- 4. insert data

INSERT INTO HANGHOA VALUES
    ('BU', 'Bàn ủi Pháp', 'Cái', 60, 350000),
    ('CD', 'Nồi cơm điện Sharp', 'Cái', 100, 700000 ),
    ('DM', 'Đầu máy Sharp', 'Cái', 75, 1200000),
    ('MG', 'Máy giặt SenYo', 'Cái', 10, 4700000),
    ('TL', 'Tủ lạnh Hitachi', 'Cái', 40, 400000),
    ('TV', 'TiVi JVC 14WS', 'Cái', 33, 7800000);

INSERT INTO KHACHHANG VALUES
    ('KH001', 'Cửa hàng Phú Lộc', 'Đà Nẵng', '0511.3246135'),
    ('KH002', 'Cửa hàng Hoàng Gia', 'Quảng Nam', '0510.66333444'),
    ('KH003', 'Nguyễn Lan Anh', 'Huế', '0988.148248'),
    ('KH004', 'Công ty TNHH An Phước', 'Đà Nẵng', '0511.6987789'),
    ('KH005', 'Huỳnh Ngọc Trung', 'Quảng Nam', '0905.888555'),
    ('KH006', 'Cửa hàng Trung Tín', 'Đà Nẵng', null);

INSERT INTO LICHSUGIA VALUES
    ('BU', '2011-01-01', 300000),
    ('BU', '2012-01-01', 350000),
    ('CD', '2011-01-06', 650000),
    ('CD', '2012-01-01', 700000),
    ('DM', '2011-01-01', 1000000),
    ('DM', '2012-01-01', 1200000),
    ('MG', '2011-01-01', 4700000),
    ('MG', '2011-01-06', 400000),
    ('TL', '2011-01-01', 5000000),
    ('TL', '2012-01-01', 5500000),
    ('TV', '2012-01-01', 7800000);

INSERT INTO DONDATHANG VALUES 
    ('DH01', '2011-02-02', 'KH001', 1),
    ('DH02', '2011-02-12', 'KH003', 1),
    ('DH03', '2011-01-22', 'KH003', 1),
    ('DH04', '2012-03-22', 'KH002', 0),
    ('DH05', '2012-04-14', 'KH005', 1),
    ('DH06', '2011-08-05', 'KH003', 1),
    ('DH07', '2011-11-25', 'KH005', 0);

INSERT INTO PHIEUGIAOHANG VALUES
    ('GH01', '2011-02-02', 'DH01'),
    ('GH02', '2011-02-15', 'DH02'),
    ('GH03', '2012-01-23', 'DH03'),
    ('GH05', '2012-04-20', 'DH05'),
    ('GH06', '2012-08-05', 'DH04');

INSERT INTO CHITIETDATHANG VALUES
    ('DH01', 'BU', 15),
    ('DH01', 'DM', 10),
    ('DH01', 'TL', 4),
    ('DH02', 'BU', 20),
    ('DH02', 'TL', 3),
    ('DH03', 'MG', 8),
    ('DH04', 'TL', 5),
    ('DH04', 'TV', 5),
    ('DH05', 'BU', 12),
    ('DH05', 'DM', 15),
    ('DH05', 'MG', 6),
    ('DH05', 'TL', 5),
    ('DH06', 'BU', 30),
    ('DH06', 'MG', 7);

INSERT INTO CHITIETGIAOHANG VALUES
    ('GH01', 'BU', 15, 300000),
    ('GH01', 'DM', 10, 1000000),
    ('GH01', 'TL', 4, 5000000),
    ('GH02', 'BU', 10, 300000),
    ('GH03', 'MG', 8, 4700000),
    ('GH05', 'BU', 12, 350000),
    ('GH05', 'DM', 15, 1200000),
    ('GH05', 'MG', 5, 4700000),
    ('GH05', 'TL', 5, 5500000),
    ('GH06', 'BU', 20, 350000),
    ('GH06', 'MG', 7, 4700000);
